# Install the dependencies.
composer install --no-interaction
bower install
bundler install
npm install

# Compile the SCSS.
./.bundle/vendor/bin/compass compile web/themes/custom/sailor

# Build Modernizr
./node_modules/.bin/modernizr -c ./modernizr.json -d ./web/vendor/modernizr/modernizr.js

# Clear Drupal's cache.
./vendor/bin/drush --root=$(pwd)/web/ cr

# Execute any database updates.
./vendor/bin/drush --root=$(pwd)/web/ updb --yes

# Execute any entity updates.
./vendor/bin/drush --root=$(pwd)/web/ entup --yes

# Import Drupal's Config.
./vendor/bin/drush --root=$(pwd)/web/ config-import --yes

# Generate the ciritcal css
(cd $(pwd)/web/ && curl -vs -H "Host: sailvenice.com" -H "X-Forwarded-Proto: https" http://127.0.0.1:8080/ 2>&1 | ../node_modules/.bin/critical --minify --src / --ignore="@font-face" > ./themes/custom/sailor/compiled/critical.css)

# Clear Drupal's cache.
./vendor/bin/drush --root=$(pwd)/web/ cr
